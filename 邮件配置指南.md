# 📧 邮件配置指南

## 🎯 配置目标
为 SDG 网站的联系表单配置邮件发送功能，当用户提交表单时自动发送邮件通知。

## ⚙️ 环境变量配置

### 1. 本地开发环境
编辑 `.env.local` 文件，添加以下配置：

```env
# 邮件服务配置
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password

# 接收联系表单的邮箱
CONTACT_EMAIL=contact@jusike.top
```

### 2. Vercel 生产环境
在 Vercel 项目设置中添加环境变量：
1. 进入 Vercel 项目 Dashboard
2. 点击 "Settings" → "Environment Variables"
3. 添加以下变量：
   - `SMTP_HOST`: smtp.gmail.com
   - `SMTP_PORT`: 587
   - `SMTP_USER`: your-email@gmail.com
   - `SMTP_PASS`: your-app-password
   - `CONTACT_EMAIL`: contact@jusike.top

## 📮 邮箱服务配置

### Gmail 配置（推荐）

**步骤 1: 启用两步验证**
1. 登录 Google 账户
2. 进入 "安全性" 设置
3. 启用 "两步验证"

**步骤 2: 生成应用专用密码**
1. 在 "安全性" 页面找到 "应用专用密码"
2. 选择 "邮件" 和 "其他（自定义名称）"
3. 输入 "SDG网站" 作为应用名称
4. 复制生成的16位密码

**步骤 3: 配置环境变量**
```env
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-gmail@gmail.com
SMTP_PASS=生成的16位应用专用密码
```

### QQ邮箱配置

**步骤 1: 开启SMTP服务**
1. 登录 QQ 邮箱
2. 进入 "设置" → "账户"
3. 开启 "POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务"
4. 获取授权码

**步骤 2: 配置环境变量**
```env
SMTP_HOST=smtp.qq.com
SMTP_PORT=587
SMTP_USER=your-qq@qq.com
SMTP_PASS=获取的授权码
```

### 163邮箱配置

**步骤 1: 开启SMTP服务**
1. 登录 163 邮箱
2. 进入 "设置" → "POP3/SMTP/IMAP"
3. 开启 "IMAP/SMTP服务"
4. 设置客户端授权密码

**步骤 2: 配置环境变量**
```env
SMTP_HOST=smtp.163.com
SMTP_PORT=587
SMTP_USER=your-163@163.com
SMTP_PASS=设置的客户端授权密码
```

## 🧪 测试配置

### 本地测试
1. 配置好 `.env.local` 文件
2. 重启开发服务器：`npm run dev`
3. 访问网站联系表单
4. 提交测试数据
5. 检查指定邮箱是否收到邮件

### API 健康检查
访问 `http://localhost:3000/api/contact` 应该返回：
```json
{
  "message": "Contact API is working",
  "timestamp": "2025-01-17T..."
}
```

## 🔒 安全注意事项

1. **不要提交敏感信息到 Git**
   - `.env.local` 已在 `.gitignore` 中
   - 生产环境使用 Vercel 环境变量

2. **使用应用专用密码**
   - 不要使用邮箱登录密码
   - 使用各邮箱服务的应用专用密码或授权码

3. **定期更换密码**
   - 定期更新应用专用密码
   - 监控邮箱安全日志

## 🚀 部署到 Vercel

1. **推送代码到 GitHub**
   ```bash
   git add .
   git commit -m "添加联系表单邮件功能"
   git push origin main
   ```

2. **在 Vercel 中配置环境变量**
   - 进入项目设置
   - 添加所有必要的环境变量
   - 重新部署项目

3. **测试生产环境**
   - 访问生产环境网站
   - 测试联系表单提交
   - 确认邮件发送正常

## 📝 故障排除

### 常见问题

**问题 1: 邮件发送失败**
- 检查环境变量是否正确配置
- 确认邮箱服务的SMTP设置
- 检查应用专用密码是否有效

**问题 2: API 返回 500 错误**
- 查看服务器日志
- 检查 nodemailer 配置
- 确认网络连接正常

**问题 3: Vercel 部署后邮件不发送**
- 确认 Vercel 环境变量已配置
- 检查生产环境日志
- 测试 API 端点是否可访问

### 调试方法

1. **查看服务器日志**
   ```bash
   # 本地开发
   npm run dev
   # 查看控制台输出
   ```

2. **测试 API 端点**
   ```bash
   curl -X POST http://localhost:3000/api/contact \
     -H "Content-Type: application/json" \
     -d '{"name":"测试","email":"test@example.com","message":"这是一条测试消息，长度超过10个字符"}'
   ```

3. **检查邮件配置**
   - 使用邮箱客户端测试SMTP设置
   - 确认防火墙不阻止SMTP端口
   - 检查邮箱服务商的安全设置
